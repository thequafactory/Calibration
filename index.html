<!DOCTYPE html>
<html>
<head>
    <title>Google Sheets Lookup</title>
    <style>
        .output {
            width: 100%;
            min-width: 200px;
            max-width: 600px;
            padding: 5px;
            font-size: 14px;
            resize: both;
            overflow: auto;
        }
    </style>
    <script>
        let excelData = {};
        const googleSheetUrl = "https://docs.google.com/spreadsheets/d/1E7uCTb7aJjlv6_cFU4r1dfZzNgP8SCTAxEkqAZ8PhVs/gviz/tq?tqx=out:json";

        function saveDataToLocalStorage() {
            localStorage.setItem("excelData", JSON.stringify(excelData));
        }

        function loadDataFromLocalStorage() {
            const savedData = localStorage.getItem("excelData");
            if (savedData) {
                excelData = JSON.parse(savedData);
            }
        }

        function loadGoogleSheetData() {
            fetch(googleSheetUrl)
                .then(response => response.text())
                .then(data => {
                    const jsonData = JSON.parse(data.substring(47, data.length - 2));
                    const rows = jsonData.table.rows;
                    
                    excelData = {};
                    rows.forEach(row => {
                        let key = row.c[0]?.v?.toString().trim();
                        if (key) {
                            excelData[key] = row.c.slice(1).map(cell => (cell ? cell.v : ""));
                        }
                    });
                    saveDataToLocalStorage();
                })
                .catch(error => console.error("Error fetching Google Sheets data:", error));
        }

        function lookupData() {
            let inputNumber = document.getElementById("inputNumber").value.trim();
            if (excelData.hasOwnProperty(inputNumber)) {
                let outputFields = document.getElementsByClassName("output");
                excelData[inputNumber].forEach((value, index) => {
                    if (outputFields[index]) {
                        outputFields[index].value = value;
                    }
                });
            } else {
                alert("Number not found in database");
            }
        }

        window.onload = function() {
            loadDataFromLocalStorage();
            if (Object.keys(excelData).length === 0) {
                loadGoogleSheetData();
            }
        };
    </script>
</head>
<body>
    <h2>Google Sheets Data Lookup</h2>
    <label for="inputNumber">Enter No.:</label>
    <input type="text" id="inputNumber">
    <button onclick="lookupData()">Search</button>
    <br><br>
    <label>Line:</label> <input type="text" class="output" readonly><br>
    <label>Location:</label> <input type="text" class="output" readonly><br>
    <label>Description of Equipment:</label> <input type="text" class="output" readonly><br>
    <label>Category of Device:</label> <input type="text" class="output" readonly><br>
    <label>S/N Code:</label> <input type="text" class="output" readonly><br>
    <label>Working Range:</label> <input type="text" class="output" readonly><br>
    <label>Equipment Range:</label> <input type="text" class="output" readonly><br>
    <label>Max Accepted Deviation:</label> <input type="text" class="output" readonly><br>
    <label>Calibration Method:</label> <input type="text" class="output" readonly><br>
    <label>Additional Info:</label> <input type="text" class="output" readonly><br>
</body>
</html>
